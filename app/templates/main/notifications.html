{% extends 'base.html' %}
{% block title %}Bildirimler{% endblock %}
{% block content %}
<div class="row">
  <div class="col-12">
    <h3 class="mb-3"><i class="fas fa-bell"></i> Bildirimler</h3>
    <form method="post" action="{{ url_for('main.notification_mark_all_read') }}" class="mb-3">
      <button class="btn btn-sm btn-outline-secondary" {% if notifications.total == 0 %}disabled{% endif %}>Hepsini Okundu İşaretle</button>
    </form>
    {% if notifications.items|length == 0 %}
      <div class="alert alert-info">Gösterilecek bildirim yok.</div>
    {% else %}
      <div class="list-group">
        {% for n in notifications.items %}
          <div class="list-group-item d-flex justify-content-between align-items-start {% if not n.is_read %}bg-light{% endif %}">
            <div class="me-2" style="min-width:0;">
              <div class="fw-semibold">
                <span class="badge bg-{{ 'danger' if n.level=='danger' else ('success' if n.level=='success' else ('warning' if n.level=='warning' else 'secondary')) }}">{{ n.level }}</span>
                {{ n.title }}
              </div>
              {% if n.message %}<div class="small text-muted mt-1" style="white-space:pre-line;">{{ n.message }}</div>{% endif %}
              <div class="small text-muted mt-1">{{ n.created_at.strftime('%d.%m.%Y %H:%M') }}{% if n.is_read %} • Okundu{% endif %}</div>
              {% if n.link_url %}
                <a href="{{ n.link_url }}" class="small">Detay &raquo;</a>
              {% endif %}
            </div>
            <div class="text-end">
              {% if not n.is_read %}
                <form method="post" action="{{ url_for('main.notification_mark_read', id=n.id) }}">
                  <button class="btn btn-sm btn-outline-primary">Okundu</button>
                </form>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
      <!-- Pagination -->
      <nav class="mt-3">
        <ul class="pagination pagination-sm">
          {% if notifications.has_prev %}
            <li class="page-item"><a class="page-link" href="{{ url_for('main.notifications', page=notifications.prev_num) }}">&laquo;</a></li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">&laquo;</span></li>
          {% endif %}
          <li class="page-item disabled"><span class="page-link">{{ notifications.page }}/{{ notifications.pages }}</span></li>
          {% if notifications.has_next %}
            <li class="page-item"><a class="page-link" href="{{ url_for('main.notifications', page=notifications.next_num) }}">&raquo;</a></li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">&raquo;</span></li>
          {% endif %}
        </ul>
      </nav>
    {% endif %}
  </div>
</div>
{% endblock %}
